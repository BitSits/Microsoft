/*
HTTP Host: static.ak.fbcdn.net
Generated: April 13th 2010 11:38:56 AM PDT
Machine: 10.16.139.105
Locale: nu_ll
Path: js/e2iq7pq6sbkgg4kg.pkg.js
*/

((location=='about:blank'&&(window.parent.eval_global||window.parent.eval))||(window.eval_global||window.eval))("if (window.CavalryLogger) { CavalryLogger.start_js([\"js\\\/e2iq7pq6sbkgg4kg.pkg.js\"]); }\n\nfunction fbpage_set_fan_status(c,f,a,h,g,d,e){g=g?g:function(j){_fbpage_show_change_status_feedback(c,j.getPayload());};var b={fbpage_id:f,add:a,reload:h};if(e!=null)copy_properties(b,e);var i=new AsyncRequest().setURI('\/ajax\/pages\/fan_status.php').setData(b).setNectarModuleDataSafe(c).setHandler(g);if(d)i.setErrorHandler(d);i.send();return false;}function fbpage_set_favorite_status(d,e,a){var f=function(){_fbpage_show_change_status_feedback(d,this.getUserData());};var c={fbpage_id:e,add:a};var b=new AsyncRequest().setMethod('POST').setURI('\/ajax\/pages\/favorite_status.php').setData(c);new Dialog().setAsync(b).setCloseHandler(f).show();return false;}function _fbpage_show_change_status_feedback(b,a){if(!a||!b)return;if(a.reload){fbpage_reload_on_fan_status_changed(a.preserve_tab);}else fbpage_redraw_on_fan_status_changed(b,a.feedback);}function fbpage_reload_on_fan_status_changed(a){var b=URI.getRequestURI();if(a)if(!b.getQueryData().v&&window.profile_tab_controller)b.addQueryData({v:window.profile_tab_controller.currentView});goURI(b,true);}function fbpage_redraw_on_fan_status_changed(a,b){if(!b)return;var d=document.createElement('span');d.innerHTML=b;CSS.setClass(d,'fan_status_inactive');a.parentNode.replaceChild(d,a);var c=function(){if(data.can_repeat_action)d.parentNode.replaceChild(a,d);};animation(d).duration(3000).checkpoint().to('backgroundColor','#FFFFFF').duration(1000).ondone(c).go();}\nfunction ConnectWidget(g,e,a,d){copy_properties(this,{like_mode:d,profile_id:e,viewer_id:g,status:null,popup:null,busy:false,new_fan:null,user_profile:null});this.fan_hidden=[];this.fan_shown=[];var b=DOM.scry(document,'div.connections');if(b.length>0){b=b[0];this.user_profile=DOM.find(b,'div.user_profile');this.new_fan=DOM.find(b,'div.grid_item_plus');this.fan_shown.push(this.new_fan);this.fan_shown.push(DOM.find(b,'span.total_plus'));var f=DOM.scry(b,'span.total');var c=DOM.scry(b,'div.grid_item');if(c.length>1)this.fan_hidden.push(c[1]);this.fan_hidden.push(f[f.length-1]);}if(!this.like_mode){this.button=$(a);this.popup_uri=new URI('\/login.php');this.popup_uri.addQueryData({connect_id:this.profile_id,popup:true});this.button.listen('click',this.connectClickHandler.bind(this));}else Arbiter.subscribe('platform\/like\/connection',this.updateWidgetFromLike.bind(this));ConnectWidget.instances[a]=this;}ConnectWidget.instances={};ConnectWidget.is_connect=true;ConnectWidget.prototype.setLoggedIn=function(a){this.viewer_id=a;return this;};ConnectWidget.prototype.connectClickHandler=function(a){a.kill();if(this.viewer_id!=0){this.connect();}else this.popUpLogin();};ConnectWidget.prototype.connect=function(){if(!this.busy){this.busy=true;fbpage_set_fan_status(this.button,this.profile_id,true,false,this.connectDoneHandler.bind(this),this.connectErrorHandler.bind(this),this.getAsyncData());}};ConnectWidget.prototype.disconnect=function(){if(!this.busy){this.busy=true;fbpage_set_fan_status(this.button,this.profile_id,false,false,this.connectUndoneHandler.bind(this),function(){},this.getAsyncData());}};ConnectWidget.prototype.getAsyncData=function(){var a={source:'connect',is_connect:ConnectWidget.is_connect};if(ge('post_form_id'))a.post_form_id=$('post_form_id').value;if(ge('fb_dtsg'))a.fb_dtsg=$('fb_dtsg').value;return a;};ConnectWidget.prototype.popUpLogin=function(){window.open(this.popup_uri.toString(),'_blank','toolbar=0,status=0,width=626,height=400');};ConnectWidget.prototype.updateWidgetFromLike=function(b,e){if(!e.userProfile)return;if(this.user_profile){var c=DOM.find(this.user_profile,'img');var a=DOM.find(this.user_profile,'a');var d=DOM.find(this.user_profile,'div.name');c.src=e.userProfile.pic_square;a.href=e.userProfile.profile_url;DOM.setContent(d,e.userProfile.name);}if(e.nowConnected){this.showNewFan();}else this.hideNewFan();};ConnectWidget.prototype.connectErrorHandler=function(b){if(b.error==kError_Async_NotLoggedIn){this.viewer_id=0;this.popUpLogin();}else if(b.error==kError_Async_PopUpCaptchaRequired){CSS.addClass(this.button,'hidden_elem');var a=$N('a',{href:DOM.find(document,'div.name_block a').href,target:'_blank'},_tx(\"Verification is needed to connect.\"));this.status=$N('span',{className:'connect_span'},a);DOM.insertAfter(this.button,this.status);}else{CSS.addClass(this.button,'hidden_elem');if(b.error==kError_ProfileConnect_AlreadyConnected){this.status=$N('span',{className:'connect_span'},_tx(\"You are a Fan.\"));}else this.status=$N('span',{className:'connect_span'},b.getErrorSummary()+': '+b.getErrorDescription());animation(this.status).from('opacity',0).to('opacity',1).go();DOM.insertAfter(this.button,this.status);}this.busy=false;};ConnectWidget.prototype.connectDoneHandler=function(c){var b=c.getPayload();if(!b||!b.feedback)return;this.status=$N('span',{className:'connect_span'},HTML(b.feedback));var d=$N('a',{className:'undo'},_tx(\"Undo\"));d.listen('click',function(e){e.kill();this.disconnect();}.bind(this));DOM.appendContent(this.status,d);animation(this.status).from('opacity',0).to('opacity',1).go();DOM.insertAfter(this.button,this.status);CSS.addClass(this.button,'hidden_elem');if(this.new_fan!=null&&b.connect_fan_div){var a=$N('div',{},HTML(b.connect_fan_div));DOM.setContent(this.new_fan,DOM.find(a,'a'));}this.showNewFan();this.busy=false;};ConnectWidget.prototype.showNewFan=function(){this.fan_shown.forEach(function(b){if(!CSS.hasClass(b,'hidden_elem'))return;var a=CSS.getStyle(b,'width');CSS.setStyle(b,'width',0);CSS.setStyle(b,'opacity',0);CSS.removeClass(b,'hidden_elem');animation(b).to('width',a).duration(100).checkpoint().to('opacity',1).duration(400).go();});this.fan_hidden.forEach(function(a){CSS.addClass(a,'hidden_elem');});};ConnectWidget.prototype.connectUndoneHandler=function(b){var a=b.getPayload();DOM.remove(this.status);animation(this.button).from('opacity',0).to('opacity',1).go();CSS.removeClass(this.button,'hidden_elem');this.hideNewFan();this.busy=false;};ConnectWidget.prototype.hideNewFan=function(){this.fan_shown.forEach(function(a){if(CSS.hasClass(a,'hidden_elem'))return;animation(a).to('opacity',0).duration(100).checkpoint(.25).to('width',0).duration(100).ondone(function(){CSS.setStyle(a,'width',null);CSS.addClass(a,'hidden_elem');this.fan_hidden.forEach(function(b){CSS.removeClass(b,'hidden_elem');});}.bind(this)).go();}.bind(this));};ConnectWidget.loadStream=function(b,a){new AsyncRequest().setMethod('GET').setURI('\/ajax\/connect\/connect_widget.php').setData({id:b}).setReadOnly(true).setErrorHandler(function(){}).setHandler(function(c){payload=c.getPayload();DOM.setContent($(a),HTML(payload.stream_markup));}.bind(this)).send();};ConnectWidget.loggedIn=function(c,a){if(ge('post_form_id')){DOM.replace($('post_form_id'),HTML(a));}else DOM.appendContent(DOM.find(document,'body'),HTML(a));for(var b in ConnectWidget.instances){ConnectWidget.instances[b].setLoggedIn(c);ConnectWidget.instances[b].connect();}};ConnectWidget.setIsConnect=function(a){ConnectWidget.is_connect=a;};\n\nif (window.Bootloader) { Bootloader.done([\"js\\\/e2iq7pq6sbkgg4kg.pkg.js\"]); }")